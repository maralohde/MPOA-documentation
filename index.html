<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>MPOA - Documentation</title>
        <!-- Favicon-->
        <link rel="icon" type="image/x-icon" href="assets/favicon1.ico" />
        <!-- Font Awesome icons (free version)-->
        <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
        <!-- Google fonts-->
        <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css" />
        <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700" rel="stylesheet" type="text/css" />

        <!-- Core theme CSS (includes Bootstrap)-->
        <link href="css/styles.css" rel="stylesheet" />
        <!-- Flatly theme -->
        <link href="css/flatly_bootstrap.css" rel="stylesheet" />
        <!-- code block theme -->
        <!-- styles and css from here: https://prismjs.com/download.html#themes=prism-tomorrow&languages=clike+javascript+bash -->
        <link href="css/style_codeblock.css" rel="stylesheet" />
        <link href="css/prism.css" rel="stylesheet" />

    </head>


<!-- Theme from here: https://bootswatch.com/flatly/ -->

    <body id="page-top">
<!-- Navigation-->
        <nav class="navbar navbar-expand-lg navbar-dark fixed-top" id="mainNav">
            <div class="container">
                <a class="navbar-brand" href="#page-top"> <a class="text-decoration-none fs-6 text-danger font-body-font-family fs-5" href="https://github.com/replikation/MPOA">MPOA REPOSITORY</a></a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars ms-1"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav text-uppercase ms-auto py-4 py-lg-0">
                        <li class="nav-item"><a class="nav-link" href="#quick">Quick Start</a></li>
                        <li class="nav-item"><a class="nav-link" href="#installation">Installation</a></li>
                        <li class="nav-item"><a class="nav-link" href="#Execution">Execution</a></li>
                        <li class="nav-item"><a class="nav-link" href="#Interpretation">Interpretation</a></li>                      
                        <li class="nav-item"><a class="nav-link" href="#Citation">Citation</a></li>
                        <li class="nav-item"><a class="nav-link" href="#faq">FAQ</a></li>  
                    </ul>
                </div>
            </div>
        </nav>
<!-- Masthead-->
        <header class="masthead">
            <div class="container">
                <div class="masthead-subheading">Documentation</div>                
                <div class="masthead-subheading">Mask Pathogens for Outbreak Analysis</div>
                <div class="masthead-heading text-uppercase">MPOA</div>
                <a class="btn btn-warning btn-lg text-uppercase" href="#quick">Quick Start</a>
            </div>
        </header>

<!-- Quick-->
        <section class="page-section" id="quick">
            <div class="container">
                <div class="text-center">
                    <h2 class="section-heading text-uppercase">Quick Start</h2>
                    <h3 class="section-subheading text-muted">If you don't have time, here is the quick summary.</h3>
                </div>
                <div class="row text-center">
                    <div class="col-md-4">
                        <span class="fa-stack fa-4x">
                            <i class="fas fa-circle fa-stack-2x text-success"></i>
                            <i class="fas fa-download fa-stack-1x fa-inverse"></i>
                        </span>
                        <h4 class="my-3">Installation</h4>
                        <p class="text-muted">git clone https://github.com/replikation/MPOA.git</p>
                    </div>
                    <div class="col-md-4">
                        <span class="fa-stack fa-4x">
                            <i class="fas fa-circle fa-stack-2x text-success"></i>
                            <i class="fas fa-gears fa-stack-1x fa-inverse"></i>
                        </span>
                        <h4 class="my-3">Run MPOA</h4>
                        <p class="text-muted">nextflow run replikation/MPOA --fastq '*.fastq.gz' --fasta '*.fasta' -profile local,docker</p>
                    </div>
                    <div class="col-md-4">
                        <span class="fa-stack fa-4x">
                            <i class="fas fa-circle fa-stack-2x text-success"></i>
                            <i class="fas fa-check fa-stack-1x fa-inverse"></i>
                        </span>
                        <h4 class="my-3"><a class=" text-decoration-none font-body-font-family" href=#Interpretation>Interpretation</a></h4>
                    </div>
                </div>
            </div> 
        </section>

<!-- Installation-->
        <section class="page-section bg-light" id="installation">
            <div class="container">
                <div class="text-center">
                    <h2 class="section-heading text-uppercase">Installation</h2>
                    <h3 class="section-subheading text-muted">Install nextflow and docker or singularity.</h3>
                </div>
            <!-- 1st part -->
                <div class="row text-left">
                    <div class="col-md-12">
                        <div class="h3 my-2 text-info"><br>1. Install Nextflow and Java</div>   
                        <p>To run MPOA the workflow manager <a href="https://nextflow.io/">Nextflow</a> and its dependency java run time (default-jre) needs to be installed.</p>
                        <p>Install java run time via:</p>
                        <pre><code class="language-bash"> sudo apt install -y default-jre</code></pre>
                        <p>Install Nextflow (this creates a nextflow file at your current location):</p>
                        <pre><code class="language-bash">curl -s https://get.nextflow.io | bash </code></pre>
                        <p> Optional: Move the executable "nextflow" to the <code> $PATH</code> location (so you can execute it from everywhere):</p>
                        <pre><code class="language-bash">sudo mv nextflow /bin && sudo chmod 770 /bin/nextflow</code></pre>
                    </div>
                </div>
            <!-- 2nd part -->
                <div class="row text-left">
                <!-- left:Docker -->
                    <div class="col-md-5">
                        <div class="h3 my-2  text-info"><br>2. Install Docker</div>   
                        <p>Full <a href="https://docs.docker.com/engine/install/">Docker</a> installation can be found here for  <a href="https://docs.docker.com/engine/install/ubuntu/">Ubuntu</a>:<div class=""></div></p>
                        <p>If you never worked with Docker we recommend to install it via apt install:</p>
                        <pre><code class="language-bash"> sudo apt install -y docker </code></pre>
                        <pre><code class="language-bash"> sudo usermod -a -G docker $USER </code></pre>
                        <p>Install Nextflow (this creates a nextflow file at your current location):</p>
                        <pre><code class="language-bash">curl -s https://get.nextflow.io | bash </code></pre>
                    </div>
                <!-- or -->
                    <div class="col-md-2 text-center text-danger"><div class="h3 my-2"><br><br><br><br><br><br>OR  </div>   </div>
                <!-- right:Singularity -->
                    <div class="col-md-5">
                        <div class="h3 my-2  text-info"><br>2. Install Singularity </div>
                        <p>As an alternative to Docker you can also install and use Singularity, e.g. on a HPC. <br><br>Singularity can be installed <a href="https://apptainer.org/documentation/">here</a>.<br><br> Note, that with Singularity the following environment variables are automatically passed to the container to ensure execution on HPCs: <code style="color:black;">HTTPS_PROXY</code>, <code style="color:black;">HTTP_PROXY</code>, <code style="color:black;">http_proxy</code>, <code style="color:black;">https_proxy</code>, <code style="color:black;">FTP_PROXY</code> and <code style="color:black;">ftp_proxy</code>.</p> 
                    </div>
            <!-- last part -->
                    <div class="row text-left">
                        <div class="col-md-12">
                            <div class="h3 my-2  text-info"><br>3. Validate the installation </div>     
                            <pre><code class="language-shell"> nextflow run replikation/MPOA --help</code></pre>
                            <p> <br> <h6>If everything is installed correctly, the MPOA help message should now be displayed in your terminal!</h6></p>
                            <!-- <pre><code class="language-java">____________________________________________________________________________________________
    
N E X T F L O W  ~  version 23.10.1
Launching `/home/mara/gits/MPOA/main.nf` [curious_ramanujan] DSL2 - revision: c8348812a3

____________________________________________________________________________________________

Workflow: MPOA - Mask bases in Pathogens for Outbreak Analysis

Usage example:
nextflow run replikation/MPOA --fastq '*.fastq' --fasta '*.fasta' -profile local,docker

Inputs (Mandatory):
    --fastq         e.g.: 'sample1.fastq' or '*.fastq' or '*/*.fastq'
    --fasta         e.g.: 'sample1.fasta' or '*.fasta' 
Reads and Genome files are matched based on the first word before the first dot in their filename.
    Matches: Sample1.clean.fasta Sample1.fastq.gz
    This NOT: clean.Sample1.clean.fasta Sample1.fastq.gz

Workflow settings  
    --frequency     Turns on frequency calculation of bases [default: false]
    --depth X       Masks regions with a sequencing depth below X with N's [default: 10]
    --motif X       Upstream and Downstream length of sequence Motif [default: 5]
    --mapper        Read mapper to use: minimap2, bwa [default: minimap2]

Options  (optional)
    --keep_coordinates     Output all reference positions, including low coverage regions.
                        Ignore insertions in the consensus and mask deletions with "*".
                        This will add '-aa --show-ins no --show-del no' to samtools consensus [default: false]
    --cores                Amount of cores for a process (local use) [default: 10]
    --max_cores            Max amount of cores for poreCov to use (local use) [default: 20]
    --memory               Available memory [default: 16]
    --output               Name of the result folder [default: results]
    --workdir              Defines the path to the temporary files [default: work/nextflow-MPOA]
    --cachedir             Defines the path where singularity images are cached [default: singularity-images]

Execution/Engine profiles (choose executer and engine)
MPOA supports profiles to run via different Executers and Engines 
examples:
    -profile local,docker
    -profile slurm,singularity

    Executer (choose one):
    local
    slurm
    Engines (choose one):
    docker
    singularity

Note: The singularity profile automatically passes the following environment variables to the container. 
to ensure execution on HPCs: HTTPS_PROXY, HTTP_PROXY, http_proxy, https_proxy, FTP_PROXY, ftp_proxy
                            </code></pre> -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

<!-- Execution-->
        <section class="page-section" id="Execution">
            <div class="container">
                <div class="text-center">
                    <h2 class="section-heading text-uppercase">Execution</h2>
                    <h3 class="section-subheading text-muted">Analyse your samples.</h3>
                </div>
                <ul class="timeline">
                    <li>
                        <div i class="timeline-image"><img class="rounded-circle img-fluid"/><i class="fas fa-file-code fa-stack-2x fs-2"></i></div>
                        <!-- <i class="fas fa-circle fa-stack-2x text-success"></i> -->
                        <!-- <i class="fas fa-gears fa-stack-1x fa-inverse"></i> -->
                        <div class="timeline-panel">
                            <div class="timeline-heading">
                                <h4>Prepare Read Data</h4>
                                <h5 class="subheading">We need one read file per sample.</h5>
                            </div>
                            <div class="timeline-body">
                                <p class="text-muted">Make sure that you have one read file <br>(<code>.fastq</code> or <code>.fastq.gz</code>) per sample.
                                You can combine multiple read files into one via: 
                                <br></pre><code>cat *.fastq > sample1_all.fastq</code><br>or <br><code>cat *.fastq.gz > sample1_all.fastq.gz</code>
                                </p>
                            </div>
                        </div>
                    </li>
                    <li class="timeline-inverted">
                        <div class="timeline-image"><img class="rounded-circle img-fluid"/><i class=" fas fa-file-signature fa-stack-2x fs-2"></i></div>
                        
                        <div class="timeline-panel">
                            <div class="timeline-heading">
                                <h4>Rename files</h4>
                                <h5 class="subheading">So MPOA can auto detect</h5>
                            </div>
                            <div class="timeline-body"><p class="text-muted">Reads and Genome files are matched based on the first word before the first dot in their filename.
                                <br>
                                <code style="color:green;">YES: Sample1.clean.fasta & Sample1.fastq.gz</code><br><code>NO: clean.Sample1.fasta & Sample1.fastq.gz</code>
                            </p></div>
                        </div>
                    </li>
                    <li>
                        <div class="timeline-image"><img class="rounded-circle img-fluid"/><i class="fas fa-laptop-code fa-stack-2x fs-2"></i></div>
                        <div class="timeline-panel">
                            <div class="timeline-heading">
                                <h4>Open terminal</h4>
                                <h5 class="subheading">In current dir</h5>
                            </div>
                            <div class="timeline-body"><p class="text-muted">Open your terminal where you have access to the fastq and fasta files.</div>
                        </div>
                    </li>
                    <li class="timeline-inverted">
                        <div class="timeline-image">
                            <h4>
                                Execute
                                <br />
                                MPOA
                                <br />
                                Now!
                            </h4>
                        </div>
                    </li>
                </ul>
                <div class="row text-left">
                    <div class="col-md-12 text-center">
                        <pre><code class="language-bash"> nextflow run replikation/MPOA --fasta '*.fasta' --fastq '*.fastq.gz' -profile local,docker -r 1.4.1</code></pre>
                    </div>
                </div>
            </div>
        </section>

<!-- Interpretation-->
        <section class="page-section bg-light" id="Interpretation">
            <div class="container">
                <div class="text-center">
                    <h2 class="section-heading text-uppercase">Interpretation</h2>
                    <h3 class="section-subheading text-muted">Some explanations and interpretation helps.</h3>
                </div>
            <!-- Ambiguous Positions -->
                <div class="row text-left">
                    <div class="col-md-12">
                        <div class="h3 my-2 text-info"><br>CSV file with summary of ambiguous/masked positions</div>   
                        <p> The default output is a CSV file summarizing the masked positions per sample. You found the information on how many positions were masked by the respective IUPAC base (N, W, S, M, K, R, Y, B, D, H, V) in <code>  masked_bases_summary.csv</code> . Depth masking (N) is performed if fewer than ten bases are present at one position. The masked positions on the entire genome and only on the chromosome are shown for each sample.</p>
                    </div>
                </div>
                <div class ="row text-left">
                    <pre><code class="language-shell"> 
                        name,type,N(ATCG),W(AT),S(CG),M(AC),K(TG),R(AG),Y(TC),B(TCG),D(ATG),H(ATC),V(ACG)
                        sample1,genome,1,0,0,1,0,14,12,0,0,0,0,
                        sample1,chromosome,1,0,0,1,0,12,9,0,0,0,0,
                        sample2,genome,3108,100,88,109,110,396,405,0,0,0,0,
                        sample2,chromosome,19,0,2,0,4,200,181,0,0,0,0,
                        sample3,genome,9534,6,14,20,10,310,293,0,0,0,0,
                        sample3,chromosome,17,0,4,4,0,266,254,0,0,0,0,
                    </code></pre>
                </div>
            <!-- Sequence Logo -->
                <div class="row text-left">
                    <div class="h3 my-2  text-info"><br>Sequence Logo <td></div> 
                <!-- left:Figure -->
                    <div class="col-md-6">
                        <img src="assets/BK16641_k14.svg" class="img-fluid rounded mx-auto" alt="Sequence Logo">
                    </div>
                <!-- right:Text -->
                    <div class="col-md-6">
                        <div class="h3 my-2  text-info"><br> </div>    
                        <p> 
                            A graphical presentation of all ambiguous positions and their surrounding bases per analyzed sample. The overall height of each stack indicates the sequence conservation at a position (measured in bits)
, whereas the height of symbols within the stack reflects the relative frequency of the corresponding
base at that position.
In default mode, the sequence logo shows five bases up and downstream of the ambiguous position masked by IUPAC-Code. The length of the logo can be modified using the <code>--motif</code> flag.  
                        </p>
                    </div>
            <!-- Frequency Plot -->                
            <div class="col-md-12 center">
                <div class="h3 my-2  text-info"><br>Frequency Plot</div>   
                <p>
                A violin chart is created when the <code> --frequency </code> flag is used. The plot is build from all analyzed samples of the run. For each ambiguous position found by aligning reads to their reference, the percentage occurrence of the bases within the reads is calculated. The orientation of the strand (forward or reverse) is determined and displayed as data points in two plots per position.                </p>
                <img src="assets/KP_33_kit14_minimap_frequency.svg" class="img-fluid rounded mx-auto" alt="Frequency Plot">
            </div>
            <!-- End Section  -->
                </div>                
            </div>
        </section>

<!-- Citation-->
        <section class="page-section" id="Citation">
            <div class="container">
                <h2 class="section-heading ">Citation</h2>
                <h4>Nanopore sequencing for accurate bacterial outbreak tracing</h5>
                <p><i>
                    Mara Lohde, Gabriel E. Wagner, Johanna Dabernig-Heinz, Adrian Viehweger, Sascha D. Braun, Stefan Monecke, Celia Diezel, Claudia Stein, Mike Marquet, Ralf Ehricht, Mathias W. Pletz, Christian Brandt
                </i></p>
                <p><a href="https://doi.org/10.1101/2023.09.15.556300">doi.org/10.1101/2023.09.15.556300</a></p>

            </div>
        </section>

<!-- FAQ --->
        <section class="page-section bg-light" id="faq">
            <div class="container text-center">
                <h2 class="section-heading text-uppercase">FAQ</h2>
                <h3 class="section-subheading text-muted">Maybe we can help you.</h3>
                <div class="row justify-content-center"><div class="col-md-8">
                <div class="accordion" id="accordionExample">
            <!-- q1 -->
                    <div class="accordion-item">
                      <h2 class="accordion-header" id="headingOne">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                          MPOA fails with Exit 137
                        </button>
                      </h2>
                      <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample">
                        <div class="accordion-body">
                          <strong>This is a RAM related error.</strong><br> This means your computer did run out of Memory. You could try in reducing the overall parallelistation of MPOA by adding the following flags for instance <code>--cores 8 --max_cores 8</code> This will execute only one process after another and assigning only 8 threads to each. This should execute less process simultaneously. MPOA was tested on a 16 GB RAM laptop with 8 threads and was working fine.
                        </div>
                      </div>
                    </div>
            <!-- q2 -->
                    <div class="accordion-item">
                      <h2 class="accordion-header" id="headingTwo">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                        How to run the lates release
                        </button>
                      </h2>
                      <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo" data-bs-parent="#accordionExample">
                        <div class="accordion-body">
                          <strong><a href="https://github.com/replikation/MPOA/releases">MPOA Releases</a></strong><br> If you want to run a specific release version of MPOA, use the <code>-r</code> flag and the version you want to execute. <br>For example: <br><code> nextflow run replikation/MPOA --fasta sample1.fasta --fastq sample1.fastq.gz -profile local,docker -r 1.4.1</code>
                        </div>
                      </div>
                    </div>
            <!-- q3 -->
                    <div class="accordion-item">
                      <h2 class="accordion-header" id="headingThree">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                          My question is not listed
                        </button>
                      </h2>
                      <div id="collapseThree" class="accordion-collapse collapse" aria-labelledby="headingThree" data-bs-parent="#accordionExample">
                        <div class="accordion-body">
                          <strong>Head over to MPOA`s <a href="https://github.com/replikation/MPOA/issues">issue sections</a></strong><br> Use search first, maybe someone had the same issue already. If not create a <a href="https://github.com/replikation/MPOA/issues/new">new issue</a>.
                        </div>
                      </div>
                    </div>
            <!-- end -->
                </div>
                </div>
            </div></div>
        </section>
<!-- Footer-->
        <footer class="footer py-4">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-4 text-lg-start">
                        <a class="btn btn-dark btn-social mx-2" href="https://twitter.com/maralohde" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                        <a class="link-dark text-decoration-none me-3" href="https://twitter.com/maralohde">Mara Lohde</a>

                    </div>
                    <div class="col-lg-4 my-3 my-lg-0">
                        <a class="link-dark text-decoration-none me-3" href="https://case-group.github.io/">CaSe Group</a>
                    </div>
                    <div class="col-lg-4 text-lg-end">
                        <a class="link-dark text-decoration-none me-3" href="https://twitter.com/gcloudChris">Christian Brandt</a>
                        <a class="btn btn-dark btn-social mx-2" href="https://twitter.com/gcloudChris" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                    </div>
                </div>
            </div>
        </footer>

        <!-- Bootstrap core JS-->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Core theme JS-->
        <script src="js/scripts.js"></script>
        <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
        <!-- * *                               SB Forms JS                               * *-->
        <!-- * * Activate your form at https://startbootstrap.com/solution/contact-forms * *-->
        <!-- * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *-->
        <script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>
        <!--Scripts for copy to clipboard -->
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
    
        
        <script src="js/script.js"></script>
        <!-- codeblock script -->

        <script src="js/prism.js"></script>
        <script src="js/script_codeblock.js"></script>
    
    </body>
</html>